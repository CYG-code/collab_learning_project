<!DOCTYPE html>
<html>
<head>
    <title>AI åä½œå­¦ä¹ å®¤</title>
    <meta charset="utf-8">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; margin: 0; padding: 20px; display: flex; justify-content: center; }
        #chat-container { width: 100%; max-width: 800px; background: white; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); display: flex; flex-direction: column; height: 90vh; }
        #header { padding: 15px 20px; background: #0078d4; color: white; border-radius: 10px 10px 0 0; font-weight: bold; font-size: 1.2em; display: flex; justify-content: space-between; }
        #messages { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        .msg-box { max-width: 80%; padding: 10px 15px; border-radius: 8px; line-height: 1.5; }
        .msg-sender { font-size: 0.8em; font-weight: bold; margin-bottom: 5px; color: #555; }
        
        /* ä¸åŒçš„æ°”æ³¡é¢œè‰² */
        .msg-Human { background: #dcf8c6; align-self: flex-end; } /* äººç±»ç»¿è‰² */
        .msg-Planner { background: #e1f5fe; align-self: flex-start; border-left: 4px solid #03a9f4; } /* è§„åˆ’å¸ˆè“è‰² */
        .msg-Facilitator { background: #fff3e0; align-self: flex-start; border-left: 4px solid #ff9800; } /* å¼•å¯¼è€…æ©™è‰² */
        .msg-System { background: #eeeeee; align-self: center; font-size: 0.85em; color: #888; text-align: center; border-radius: 20px; padding: 5px 15px; }
        
        #input-area { display: flex; padding: 15px; border-top: 1px solid #ddd; background: #fafafa; border-radius: 0 0 10px 10px; }
        #messageText { flex: 1; padding: 12px; border: 1px solid #ccc; border-radius: 5px; outline: none; font-size: 1em; }
        #messageText:focus { border-color: #0078d4; }
        button { padding: 12px 25px; background: #0078d4; color: white; border: none; border-radius: 5px; margin-left: 10px; cursor: pointer; font-weight: bold; font-size: 1em; }
        button:hover { background: #005a9e; }
    </style>
</head>
<body>
    <div id="chat-container">
        <div id="header">
            <span>ğŸŒ å¤šäººåä½œ + å¤šæ™ºèƒ½ä½“å­¦ä¹ å®¤</span>
            <span id="user-display">æœªè¿æ¥</span>
        </div>
        <div id="messages"></div>
        <div id="input-area">
            <input type="text" id="messageText" autocomplete="off" placeholder="è¾“å…¥ä½ æƒ³æ¢è®¨çš„é—®é¢˜ï¼ŒæŒ‰å›è½¦å‘é€..."/>
            <button onclick="sendMessage()">å‘é€</button>
        </div>
    </div>

    <script>
        // 1. è·å–ç”¨æˆ·èº«ä»½
        let username = prompt("æ¬¢è¿æ¥åˆ°åä½œå®¤ï¼è¯·è¾“å…¥ä½ çš„åå­— (å¦‚ï¼šå¼ ä¸‰ã€åŒå­¦A)ï¼š");
        if (!username) username = "åŒ¿åè€…" + Math.floor(Math.random()*1000);
        document.getElementById("user-display").innerText = "å½“å‰èº«ä»½: " + username;

        // 2. å»ºç«‹ WebSocket è¿æ¥
        let ws = new WebSocket(`ws://localhost:8000/ws/${username}`);

        // 3. æ¥æ”¶å¹¿æ’­æ¶ˆæ¯å¹¶æ¸²æŸ“åˆ°ç•Œé¢
        ws.onmessage = function(event) {
            let data = JSON.parse(event.data);
            let messages = document.getElementById('messages');
            let msgDiv = document.createElement('div');
            
            // åˆ¤æ–­æ˜¯è°å‘çš„æ¶ˆæ¯ï¼Œåº”ç”¨ä¸åŒçš„ CSS æ°”æ³¡æ ·å¼
            let roleClass = "msg-System";
            if (data.sender === username || data.sender !== "Planner" && data.sender !== "Facilitator" && data.sender !== "System") {
                roleClass = "msg-Human"; // æ— è®ºæ˜¯ä½ è¿˜æ˜¯åˆ«çš„åŒå­¦ï¼Œéƒ½ç”¨ç»¿è‰²æ°”æ³¡
            } else if (data.sender === "Planner") {
                roleClass = "msg-Planner";
            } else if (data.sender === "Facilitator") {
                roleClass = "msg-Facilitator";
            }

            msgDiv.className = `msg-box ${roleClass}`;
            
            // System æ¶ˆæ¯ä¸æ˜¾ç¤ºåå­—
            if (data.sender === "System") {
                msgDiv.innerText = data.message;
            } else {
                msgDiv.innerHTML = `<div class="msg-sender">${data.sender}</div><div>${data.message}</div>`;
            }

            messages.appendChild(msgDiv);
            // è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€åº•éƒ¨
            messages.scrollTop = messages.scrollHeight;
        };

        // 4. å‘é€æ¶ˆæ¯
        function sendMessage() {
            let input = document.getElementById("messageText");
            if (input.value.trim() !== "") {
                ws.send(input.value);
                input.value = '';
            }
        }

        // ç»‘å®šå›è½¦é”®å‘é€
        document.getElementById("messageText").addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                sendMessage();
            }
        });
    </script>
</body>
</html>